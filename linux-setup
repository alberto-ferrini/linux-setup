#!/bin/bash

set -eu

version=1.0.0
base_url=https://raw.githubusercontent.com/alberto-ferrini/linux-setup/refs/heads/main

echo ğŸ”µ Linux Setup $version

echo â³ Checking for update...
# Download the content of the file into a variable
online_content=$(curl -s $base_url/linux-setup)

# Use grep to find the line starting with 'linuxSetupVersion=' and sed to extract the value after '='
online_version=$(echo "$online_content" | grep '^version=' | sed 's/^version=//')

if [ $version = $online_version ]; then
    echo "ğŸŸ¢ Linux Setup is up to date"
else
    echo "ğŸŸ¡ Update is available (v. $online_version)"
    read -p "ğŸ‘‰ Do you want to upgrade now (y/n)? " answer
    if [ $answer = "y" ]; then
        echo "â³ Updating..."
        curl -sL $base_url/linux-setup -o $HOME/linux-setup
        chmod 755 $HOME/linux-setup
        $HOME/linux-setup
    fi
fi

echo
echo "ğŸ“˜ Git"

if ! command -v git &> /dev/null; then
    echo "ğŸŸ¡ Git is not installed"
    read -p "ğŸ‘‰ Do you want to install (y/n)? " answer
    if [ $answer = "y" ]; then
        echo "â³ Installing..."
        sudo apt-get install -y git &> /dev/null
    fi
fi
if command -v git &> /dev/null; then
    git_version=$(git --version | sed 's/.* //')
    echo "ğŸŸ¢ Git installed (v. $git_version)"
    git_store=$(git config --global --get credential.helper || true)
    if [ -z "$git_store" ]; then
        echo "ğŸŸ¡ Git credential storage not enabled"
        read -p "ğŸ‘‰ Do you want to enable (y/n)? " answer
        if [ $answer = "y" ]; then
            echo "â³ Enabling..."
            git config --global credential.helper store
            echo "ğŸŸ¢ Git credential storage enabled"
        fi
    else
        echo "ğŸŸ¢ Git credential storage enabled"
    fi
fi
